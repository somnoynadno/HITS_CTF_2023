# d4M493d7Ok3n (Medium) [Base64]

## Авторы
Галяткин Дмитрий, Грицаев Никита, Данил Зубов, Баян Шонходоев

## Описание
Преподаватель с помощью python-скрипта генерирует поврежденный токен, который нужно будет дать студентам на расшифровку (в токене спрятан флаг). Запуск скрипта (и ввод флага) подробнее описан ниже в разделе Инструкция по развертыванию.

Скрипт берет флаг, сдвигает буквы на 11 позиций (влево), цифры на 7 позиций (влево), после чего генерирует поврежденный JWT-токен. А именно: вместо сигнатуры просто случайный набор символов в Base64, у части header отрезается начало (eyJ), у части payload также отрезается начало (ey, а не eyJ).

В header содержится информация о том, что цифры сдвинуты на 7 позиций. В payload есть множество полей, и одно из них содержит настоящий флаг (это поле 10210897103 => 102 108 97 103 => 'flag', то есть ASCII-кодировка), к которому применены сдвиги.

## Легенда
На несанкционированной свалке HTTP-куки мистер Икс нашел интересный экземпляр. К сожалению, мистер Икс очень неуклюжий, поэтому неудивительно, что он поскользнулся, упал, повредил свою находку и теперь не может ее раскодировать. За помощью он обратился к Вам. По его словам, нужно восстановить поврежденный куки и извлечь из него флаг...  


## Подсказки к решению
- Это JWT-токен. После повреждения пропало несколько первых символов в заголовке и полезной нагрузке, а сигнатура была безнадежно испорчена
- Если Вы уже восстановили токен, обратите внимание на полезную нагрузку. 'Ключи' закодированы в ASCII, 'значения' - с помощью сдвига (притом буквы и цифры сдвигались на разное число позиций).

## Инструкция по развертыванию
Необходимо запустить Python-скрипт (taskgenerator.py, работа проверялась на версии 3.7.7). После запуска появится предложение сменить флаг по умолчанию.

Если Вы хотите сделать это, введите y (игрек). После этого введите флаг (поддерживаются только латинские символы, цифры, нижнее подчеркивание), и скрипт выведет сгенерированный поврежденный токен, в котором хранится введенный Вами флаг. Часть флага HITS и фигурные скобки {} вводить не нужно.

Если Вы не хотите использовать другой флаг, введите n. Скрипт выведет сгенерированный поврежденный токен, в котором хранится флаг по умолчанию HITS{JWT_41w4y5_st4rt5_w1th_3y}.

Помимо этого, скрипт создает файл output.txt и записывает туда тот же самый токен.

## Флаг
Флаг по умолчанию: HITS{JWT_41w4y5_st4rt5_w1th_3y}

Изменить флаг легко, это описано в разделе Инструкция по развертыванию

## Инструкция по прорешиванию и получению флага
- Заметить, что поврежденный куки имеет структуру JWT токена (можно понять, например, по точкам)
- Вспомнить, что заголовок JWT обычно начинается с eyJ, а полезная нагрузка - с ey
- Приписать к заголовку в начало строки eyJ, а к полезной нагрузке - ey
- Раскодировать полученный токен, например, на jwt.io
- Увидеть в полезной нагрузке множество зашифрованных флагов, понять, что сдвиг по буквам равен 11 (HITS превратился в STED), а по цифрам 7 (это написано в заголовке)
- Осталось выбрать нужный флаг из всего множества, это можно сделать, поняв, что ключи вида 10110897103 закодированы в ASCII. Например, ключ 10110897103 => 101 108 97 103 => chr(101) chr(108) chr(97) chr(103) => 'elag'. Аналогично можно заметить, что все другие ключи очень похожи: 'alag', 'blag' и так далее. Найдем поле 'flag', ему будет соответствовать поле 10210897103.
- Нужный флаг найден, осталось его расшифровать, зная сдвиги


